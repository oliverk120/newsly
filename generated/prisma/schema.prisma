// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Article {
  id          Int      @id @default(autoincrement())
  title       String?
  description String?
  time        String?
  link        String   @unique
  image       String?
  created_at  DateTime @default(now())

  ArticleFilterMatch    ArticleFilterMatch[]
  ArticleEnrichment     ArticleEnrichment?
  ArticleEnrichmentStep ArticleEnrichmentStep[]

  @@map("articles")
}

model Filter {
  id         Int      @id @default(autoincrement())
  name       String?
  type       String
  value      String?
  active     Int      @default(1)
  created_at DateTime @default(now())

  ArticleFilterMatch ArticleFilterMatch[]

  @@map("filters")
}

model ArticleFilterMatch {
  id         Int      @id @default(autoincrement())
  article_id Int
  filter_id  Int
  matched_at DateTime @default(now())

  Article Article @relation(fields: [article_id], references: [id])
  Filter  Filter  @relation(fields: [filter_id], references: [id])

  @@map("article_filter_matches")
}

model ArticleEnrichment {
  article_id       Int     @id
  embedding        String?
  is_mna           Int?
  acquiror         String?
  seller           String?
  target           String?
  deal_value       String?
  industry         String?
  extra            String?
  article_date     String?
  location         String?
  body             String?
  transaction_type String?
  completed        String?
  log              String?
  summary          String?
  sector           String?

  Article Article @relation(fields: [article_id], references: [id])

  @@map("article_enrichments")
}

model ArticleEnrichmentStep {
  article_id   Int
  step_name    String
  completed_at DateTime @default(now())

  Article Article @relation(fields: [article_id], references: [id])

  @@id([article_id, step_name])
  @@map("article_enrichment_steps")
}

model Prompt {
  name     String @id
  template String

  @@map("prompts")
}

model Source {
  id                   Int     @id @default(autoincrement())
  base_url             String?
  article_selector     String?
  title_selector       String?
  description_selector String?
  time_selector        String?
  link_selector        String?
  image_selector       String?
  body_selector        String?
  location_selector    String?
  date_selector        String?

  @@map("sources")
}
