<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>News Scraper</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="p-4">
    <h1 class="text-2xl font-bold mb-4">News Scraper</h1>

    <h2 class="text-xl font-semibold mb-2">Sources</h2>
    <table class="table-auto w-full mb-6 border-collapse" id="sourcesTable">
      <thead>
        <tr>
          <th class="border px-2 py-1">Base URL</th>
          <th class="border px-2 py-1">Article Selector</th>
          <th class="border px-2 py-1">Title Selector</th>
          <th class="border px-2 py-1">Description Selector</th>
          <th class="border px-2 py-1">Time Selector</th>
          <th class="border px-2 py-1">Link Selector</th>
          <th class="border px-2 py-1">Image Selector</th>
        </tr>
      </thead>
      <tbody id="sourcesBody"></tbody>
    </table>

    <button id="scrapeBtn" class="bg-blue-500 text-white px-4 py-2 rounded mb-4">Scrape Articles</button>

    <h2 class="text-xl font-semibold mb-2">Articles</h2>
    <table class="table-auto w-full border-collapse">
      <thead>
        <tr>
          <th class="border px-2 py-1">Title</th>
          <th class="border px-2 py-1">Description</th>
          <th class="border px-2 py-1">Time</th>
          <th class="border px-2 py-1">Link</th>
        </tr>
      </thead>
      <tbody id="articlesBody"></tbody>
    </table>
    <script>
      async function loadSources() {
        const res = await fetch('/sources');
        const sources = await res.json();
        const tbody = document.getElementById('sourcesBody');
        tbody.innerHTML = '';
        sources.forEach((s) => {
          const tr = document.createElement('tr');
          tr.innerHTML =
            `<td class="border px-2 py-1">${s.base_url}</td>` +
            `<td class="border px-2 py-1">${s.article_selector}</td>` +
            `<td class="border px-2 py-1">${s.title_selector}</td>` +
            `<td class="border px-2 py-1">${s.description_selector || ''}</td>` +
            `<td class="border px-2 py-1">${s.time_selector || ''}</td>` +
            `<td class="border px-2 py-1">${s.link_selector || ''}</td>` +
            `<td class="border px-2 py-1">${s.image_selector || ''}</td>`;
          tbody.appendChild(tr);
        });
      }

      async function loadArticles() {
        const res = await fetch("/articles");
        const articles = await res.json();
        const tbody = document.getElementById("articlesBody");
        tbody.innerHTML = "";
        articles.forEach((a) => {
          const tr = document.createElement("tr");
          tr.innerHTML =
            `<td class="border px-2 py-1">${a.title}</td>` +
            `<td class="border px-2 py-1">${a.description}</td>` +
            `<td class="border px-2 py-1">${a.time}</td>` +
            `<td class="border px-2 py-1"><a class="text-blue-600 underline" href="${a.link}" target="_blank">Link</a></td>`;
          tbody.appendChild(tr);
        });
      }

      document
        .getElementById("scrapeBtn")
        .addEventListener("click", async () => {
          await fetch("/scrape");
          loadArticles();
        });

      loadSources();
      loadArticles();
    </script>
  </body>
</html>
